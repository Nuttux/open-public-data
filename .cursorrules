# Project Rules - Données Lumières

> Stack: Next.js 16 + dbt + BigQuery
> Docs détaillés: `docs/architecture-modelling.md`, `docs/architecture-frontend.md`

## Project Structure
pipeline/          # dbt models + scripts d'export
website/           # Next.js app
docs/              # Architecture docs

## Critical Business Logic (MUST READ)

### Anti-Double Counting
- Use ONLY `Type d'opération = 'Réel'` (exclude 'Pour Ordre')
- Never sum `Montant AP` (use `Mandaté après régul.`)
- Subventions are a SUBSET of budget, not an addition

### Data Sources
- Truth source: `core_budget` (from `stg_budget_principal`)
- Subventions enrichies: `core_subventions`
- See `docs/architecture-modelling.md` for full data lineage

## Conventions

### dbt/SQL
- French column names in models
- Naming: `stg_*`, `int_*`, `core_*`, `mart_*`
- OBT (One Big Table) per entity design for core layer

### Frontend
- Static JSON in `website/public/data/` (no live BigQuery calls)
- French UI text, French number formatting
- Dark theme (slate-800/900)

## Commands
- dbt: `cd pipeline && dbt run`
- Export: `python pipeline/scripts/export/export_all.py`
- Website: `cd website && npm run dev`## 12. Git Safety

- **⚠️ NEVER push to origin main** without explicit user request
- Always push to current feature branch (e.g., git push origin theo2)
- If user says 'push to main', ask for confirmation first
